/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
CKEDITOR.dialog.add("colordialog",function(a){function h(){c.getById(u).removeStyle("background-color"),e.getContentElement("picker","selectedColor").setValue(""),g&&g.removeAttribute("aria-selected"),g=null}function i(a){var b=a.data.getTarget(),c;b.getName()=="td"&&(c=b.getChild(0).getHtml())&&(g=b,g.setAttribute("aria-selected",!0),e.getContentElement("picker","selectedColor").setValue(c))}function j(a){a=a.replace(/^#/,"");for(var b=0,c=[];b<=2;b++)c[b]=parseInt(a.substr(b*2,2),16);var d=.2126*c[0]+.7152*c[1]+.0722*c[2];return"#"+(d>=165?"000":"fff")}function m(a){!a.name&&(a=new CKEDITOR.event(a));var b=!/mouse/.test(a.name),d=a.data.getTarget(),e;d.getName()=="td"&&(e=d.getChild(0).getHtml())&&(o(a),b?k=d:l=d,b&&(d.setStyle("border-color",j(e)),d.setStyle("border-style","dotted")),c.getById(s).setStyle("background-color",e),c.getById(t).setHtml(e))}function n(){var a=k.getChild(0).getHtml();k.setStyle("border-color",a),k.setStyle("border-style","solid"),c.getById(s).removeStyle("background-color"),c.getById(t).setHtml("&nbsp;"),k=null}function o(a){var b=!/mouse/.test(a.name),d=b&&k;if(d){var e=d.getChild(0).getHtml();d.setStyle("border-color",e),d.setStyle("border-style","solid")}!k&&!l&&(c.getById(s).removeStyle("background-color"),c.getById(t).setHtml("&nbsp;"))}function p(b){var c=b.data,d=c.getTarget(),e,f,g=c.getKeystroke(),h=a.lang.dir=="rtl";switch(g){case 38:if(e=d.getParent().getPrevious())f=e.getChild([d.getIndex()]),f.focus();c.preventDefault();break;case 40:if(e=d.getParent().getNext())f=e.getChild([d.getIndex()]),f&&f.type==1&&f.focus();c.preventDefault();break;case 32:case 13:i(b),c.preventDefault();break;case h?37:39:if(f=d.getNext())f.type==1&&(f.focus(),c.preventDefault(!0));else if(e=d.getParent().getNext())f=e.getChild([0]),f&&f.type==1&&(f.focus(),c.preventDefault(!0));break;case h?39:37:if(f=d.getPrevious())f.focus(),c.preventDefault(!0);else if(e=d.getParent().getPrevious())f=e.getLast(),f.focus(),c.preventDefault(!0);break;default:return}}function q(){function c(c,d){for(var f=c;f<c+3;f++){var g=new b(v.$.insertRow(-1));g.setAttribute("role","row");for(var h=d;h<d+3;h++)for(var i=0;i<6;i++)e(g.$,"#"+a[h]+a[i]+a[f])}}function e(a,c){var d=new b(a.insertCell(-1));d.setAttribute("class","ColorCell"),d.setAttribute("tabIndex",-1),d.setAttribute("role","gridcell"),d.on("keydown",p),d.on("click",i),d.on("focus",m),d.on("blur",o),d.setStyle("background-color",c),d.setStyle("border","1px solid "+c),d.setStyle("width","14px"),d.setStyle("height","14px");var e=r("color_table_cell");d.setAttribute("aria-labelledby",e),d.append(CKEDITOR.dom.element.createFromHtml('<span id="'+e+'" class="cke_voice_label">'+c+"</span>",CKEDITOR.document))}v=CKEDITOR.dom.element.createFromHtml('<table tabIndex="-1" aria-label="'+d.options+'"'+' role="grid" style="border-collapse:separate;" cellspacing="0">'+'<caption class="cke_voice_label">'+d.options+"</caption>"+'<tbody role="presentation"></tbody></table>'),v.on("mouseover",m),v.on("mouseout",o);var a=["00","33","66","99","cc","ff"];c(0,0),c(3,0),c(0,3),c(3,3);var f=new b(v.$.insertRow(-1));f.setAttribute("role","row");for(var g=0;g<6;g++)e(f.$,"#"+a[g]+a[g]+a[g]);for(var h=0;h<12;h++)e(f.$,"#000000")}var b=CKEDITOR.dom.element,c=CKEDITOR.document,d=a.lang.colordialog,e,f={type:"html",html:"&nbsp;"},g,k,l,r=function(a){return CKEDITOR.tools.getNextId()+"_"+a},s=r("hicolor"),t=r("hicolortext"),u=r("selhicolor"),v;return q(),{title:d.title,minWidth:360,minHeight:220,onLoad:function(){e=this},onHide:function(){h(),n()},contents:[{id:"picker",label:d.title,accessKey:"I",elements:[{type:"hbox",padding:0,widths:["70%","10%","30%"],children:[{type:"html",html:"<div></div>",onLoad:function(){CKEDITOR.document.getById(this.domId).append(v)},focus:function(){(k||this.getElement().getElementsByTag("td").getItem(0)).focus()}},f,{type:"vbox",padding:0,widths:["70%","5%","25%"],children:[{type:"html",html:"<span>"+d.highlight+'</span>												<div id="'+s+'" style="border: 1px solid; height: 74px; width: 74px;"></div>												<div id="'+t+'">&nbsp;</div><span>'+d.selected+'</span>												<div id="'+u+'" style="border: 1px solid; height: 20px; width: 74px;"></div>'},{type:"text",label:d.selected,labelStyle:"display:none",id:"selectedColor",style:"width: 74px",onChange:function(){try{c.getById(u).setStyle("background-color",this.getValue())}catch(a){h()}}},f,{type:"button",id:"clear",style:"margin-top: 5px",label:d.clear,onClick:h}]}]}]}]}});